
# Map test

```{ojs}
d3 = require("d3@7")
geoviz = require("geoviz@0.6.7")

dummy_data = [
  {cc_iso3c: "AFG", value: 0.392354124748491, raw_value: -0.54},
  {cc_iso3c: "AGO", value: 0.523138832997988, raw_value: 0.11},
  {cc_iso3c: "ALB", value: 0.503018108651911, raw_value: 0.01},
  {cc_iso3c: "AND", value: 0.132796780684105, raw_value: -1.83},
  {cc_iso3c: "ARE", value: 0.388329979879276, raw_value: -0.56},
  {cc_iso3c: "ARG", value: 0.203219315895372, raw_value: -1.48},
  {cc_iso3c: "ARM", value: 0.48692152917505, raw_value: -0.07},
  {cc_iso3c: "ATG", value: 0.193158953722334, raw_value: -1.53},
  {cc_iso3c: "AUS", value: 0.195171026156942, raw_value: -1.52},
  {cc_iso3c: "AUT", value: 0.820925553319919, raw_value: 1.59},
  {cc_iso3c: "AZE", value: 0.653923541247485, raw_value: 0.76},
  {cc_iso3c: "BDI", value: 0.927565392354125, raw_value: 2.12},
  {cc_iso3c: "BEL", value: 0.674044265593561, raw_value: 0.86},
  {cc_iso3c: "BEN", value: null, raw_value: 0.17},
  {cc_iso3c: "BFA", value: 0.51307847082495, raw_value: 0.06},
  {cc_iso3c: "BGD", value: 0.37625754527163, raw_value: -0.62},
  {cc_iso3c: "BGR", value: 0.440643863179074, raw_value: -0.3},
  {cc_iso3c: "BHR", value: 0.822937625754527, raw_value: 1.6},
  {cc_iso3c: "BHS", value: 0.977867203219316, raw_value: 2.37},
  {cc_iso3c: "BIH", value: 0.728370221327968, raw_value: 1.13},
  {cc_iso3c: "BLR", value: 0.949698189134809, raw_value: 2.23},
  {cc_iso3c: "BLZ", value: 0.41046277665996, raw_value: -0.45},
  {cc_iso3c: "BOL", value: 0.995975855130785, raw_value: 2.46},
  {cc_iso3c: "BRA", value: 0.728370221327968, raw_value: 1.13},
  {cc_iso3c: "BRB", value: 0.720321931589537, raw_value: 1.09},
  {cc_iso3c: "BRN", value: 0.482897384305835, raw_value: -0.09},
  {cc_iso3c: "BTN", value: null, raw_value: 0.35},
  {cc_iso3c: "BWA", value: 0.160965794768612, raw_value: -1.69},
  {cc_iso3c: "CAF", value: 0.925553319919517, raw_value: 2.11},
  {cc_iso3c: "CAN", value: 0.923541247484909, raw_value: 2.1},
  {cc_iso3c: "CHE", value: 0.621730382293763, raw_value: 0.6},
  {cc_iso3c: "CHL", value: 0.975855130784708, raw_value: 2.36},
  {cc_iso3c: "CHN", value: 0.933601609657948, raw_value: 2.15},
  {cc_iso3c: "CIV", value: 0.561368209255533, raw_value: 0.3},
  {cc_iso3c: "CMR", value: 0.653923541247485, raw_value: 0.76},
  {cc_iso3c: "COD", value: 0.525150905432596, raw_value: 0.12},
  {cc_iso3c: "COG", value: 0.641851106639839, raw_value: 0.7},
  {cc_iso3c: "COL", value: 0.464788732394366, raw_value: -0.18},
  {cc_iso3c: "COM", value: 0.301810865191147, raw_value: -0.99},
  {cc_iso3c: "CPV", value: 0.122736418511066, raw_value: -1.88},
  {cc_iso3c: "CRI", value: 0.17102615694165, raw_value: -1.64},
  {cc_iso3c: "CUB", value: 0.86317907444668, raw_value: 1.8},
  {cc_iso3c: "CYP", value: 0.674044265593561, raw_value: 0.86},
  {cc_iso3c: "CZE", value: 0.6579476861167, raw_value: 0.78},
  {cc_iso3c: "DEU", value: 0.327967806841046, raw_value: -0.86},
  {cc_iso3c: "DJI", value: 0.585513078470825, raw_value: 0.42},
  {cc_iso3c: "DMA", value: 0.62374245472837, raw_value: 0.61},
  {cc_iso3c: "DNK", value: 0.676056338028169, raw_value: 0.87},
  {cc_iso3c: "DOM", value: 0.150905432595573, raw_value: -1.74},
  {cc_iso3c: "DZA", value: 0.503018108651911, raw_value: 0.01},
  {cc_iso3c: "ECU", value: 0.148893360160966, raw_value: -1.75},
  {cc_iso3c: "EGY", value: 0.919517102615694, raw_value: 2.08},
  {cc_iso3c: "ERI", value: 0.885311871227364, raw_value: 1.91},
  {cc_iso3c: "ESH", value: 0.573440643863179, raw_value: 0.36},
  {cc_iso3c: "ESP", value: 0.241448692152918, raw_value: -1.29},
  {cc_iso3c: "EST", value: 0.152917505030181, raw_value: -1.73},
  {cc_iso3c: "ETH", value: 0.390342052313883, raw_value: -0.55},
  {cc_iso3c: "FIN", value: 0.665995975855131, raw_value: 0.82},
  {cc_iso3c: "FJI", value: 0.883299798792757, raw_value: 1.9},
  {cc_iso3c: "FRA", value: 0.496981891348089, raw_value: -0.02},
  {cc_iso3c: "FSM", value: 0.426559356136821, raw_value: -0.37},
  {cc_iso3c: "GAB", value: 0.169014084507042, raw_value: -1.65},
  {cc_iso3c: "GBR", value: 0.462776659959759, raw_value: -0.19},
  {cc_iso3c: "GEO", value: 0.963782696177062, raw_value: 2.3},
  {cc_iso3c: "GHA", value: 0.822937625754527, raw_value: 1.6},
  {cc_iso3c: "GIN", value: 0.183098591549296, raw_value: -1.58},
  {cc_iso3c: "GMB", value: 0.873239436619718, raw_value: 1.85},
  {cc_iso3c: "GNB", value: 0.438631790744467, raw_value: -0.31},
  {cc_iso3c: "GNQ", value: 0.758551307847082, raw_value: 1.28},
  {cc_iso3c: "GRC", value: 0.448692152917505, raw_value: -0.26},
  {cc_iso3c: "GRD", value: 0.225352112676056, raw_value: -1.37},
  {cc_iso3c: "GRL", value: 0.802816901408451, raw_value: 1.5},
  {cc_iso3c: "GTM", value: null, raw_value: null},
  {cc_iso3c: "GUF", value: 0.690140845070423, raw_value: 0.94},
  {cc_iso3c: "GUY", value: 0.140845070422535, raw_value: -1.79},
  {cc_iso3c: "HND", value: 0.889336016096579, raw_value: 1.93},
  {cc_iso3c: "HRV", value: 0.134808853118712, raw_value: -1.82},
  {cc_iso3c: "HTI", value: 0.748490945674044, raw_value: 1.23},
  {cc_iso3c: "HUN", value: 0.885311871227364, raw_value: 1.91},
  {cc_iso3c: "IDN", value: 0.362173038229376, raw_value: -0.69},
  {cc_iso3c: "IND", value: 0.720321931589537, raw_value: 1.09},
  {cc_iso3c: "IRL", value: 0.181086519114688, raw_value: -1.59},
  {cc_iso3c: "IRN", value: 0.724346076458752, raw_value: 1.11},
  {cc_iso3c: "IRQ", value: 0.3420523138833, raw_value: -0.79},
  {cc_iso3c: "ISL", value: 0.398390342052314, raw_value: -0.51},
  {cc_iso3c: "ISR", value: 0.559356136820926, raw_value: 0.29},
  {cc_iso3c: "ITA", value: 0.935613682092555, raw_value: 2.16},
  {cc_iso3c: "JAM", value: 0.603621730382294, raw_value: 0.51},
  {cc_iso3c: "JOR", value: 0.762575452716298, raw_value: 1.3},
  {cc_iso3c: "JPN", value: 0.0462776659959759, raw_value: -2.26},
  {cc_iso3c: "KAZ", value: 0.446680080482897, raw_value: -0.27},
  {cc_iso3c: "KEN", value: null, raw_value: 2.43},
  {cc_iso3c: "KGZ", value: 0.378269617706237, raw_value: -0.61},
  {cc_iso3c: "KHM", value: 0.708249496981891, raw_value: 1.03},
  {cc_iso3c: "KIR", value: 0.670020120724346, raw_value: 0.84},
  {cc_iso3c: "KNA", value: 0.354124748490946, raw_value: -0.73},
  {cc_iso3c: "KOR", value: 0.851106639839034, raw_value: 1.74},
  {cc_iso3c: "KWT", value: 0.13682092555332, raw_value: -1.81},
  {cc_iso3c: "LAO", value: 0.782696177062374, raw_value: 1.4},
  {cc_iso3c: "LBN", value: 0.104627766599598, raw_value: -1.97},
  {cc_iso3c: "LBR", value: 0.291750503018109, raw_value: -1.04},
  {cc_iso3c: "LBY", value: 0.0744466800804829, raw_value: -2.12},
  {cc_iso3c: "LCA", value: 0.233400402414487, raw_value: -1.33},
  {cc_iso3c: "LIE", value: 0.51307847082495, raw_value: 0.06},
  {cc_iso3c: "LKA", value: 0.680080482897384, raw_value: 0.89},
  {cc_iso3c: "LSO", value: 0.0865191146881288, raw_value: -2.06},
  {cc_iso3c: "LTU", value: 0.531187122736418, raw_value: 0.15},
  {cc_iso3c: "LUX", value: 0.756539235412475, raw_value: 1.27},
  {cc_iso3c: "LVA", value: 0.690140845070423, raw_value: 0.94},
  {cc_iso3c: "MAR", value: 0.680080482897384, raw_value: 0.89},
  {cc_iso3c: "MCO", value: 0.193158953722334, raw_value: -1.53},
  {cc_iso3c: "MDA", value: 0.796780684104628, raw_value: 1.47},
  {cc_iso3c: "MDG", value: null, raw_value: null},
  {cc_iso3c: "MDV", value: 0.641851106639839, raw_value: 0.7},
  {cc_iso3c: "MEX", value: 0.668008048289738, raw_value: 0.83},
  {cc_iso3c: "MHL", value: 0.138832997987928, raw_value: -1.8},
  {cc_iso3c: "MKD", value: 0.955734406438632, raw_value: 2.26},
  {cc_iso3c: "MLI", value: 0.52112676056338, raw_value: 0.1},
  {cc_iso3c: "MLT", value: 0.714285714285714, raw_value: 1.06},
  {cc_iso3c: "MMR", value: 0.17102615694165, raw_value: -1.64},
  {cc_iso3c: "MNE", value: 0.440643863179074, raw_value: -0.3},
  {cc_iso3c: "MNG", value: 0.193158953722334, raw_value: -1.53},
  {cc_iso3c: "MOZ", value: 0.724346076458752, raw_value: 1.11},
  {cc_iso3c: "MRT", value: 0.867203219315895, raw_value: 1.82},
  {cc_iso3c: "MUS", value: 0.37625754527163, raw_value: -0.62},
  {cc_iso3c: "MWI", value: 0.774647887323944, raw_value: 1.36},
  {cc_iso3c: "MYS", value: 0.772635814889336, raw_value: 1.35},
  {cc_iso3c: "NAM", value: null, raw_value: null},
  {cc_iso3c: "NER", value: 0.382293762575453, raw_value: -0.59},
  {cc_iso3c: "NGA", value: 0.792756539235412, raw_value: 1.45},
  {cc_iso3c: "NIC", value: null, raw_value: 1.81},
  {cc_iso3c: "NLD", value: null, raw_value: -2.39},
  {cc_iso3c: "NOR", value: 0.267605633802817, raw_value: -1.16},
  {cc_iso3c: "NPL", value: 0.869215291750503, raw_value: 1.83},
  {cc_iso3c: "NRU", value: 0.883299798792757, raw_value: 1.9},
  {cc_iso3c: "NZL", value: 0.122736418511066, raw_value: -1.88},
  {cc_iso3c: "OMN", value: 0.883299798792757, raw_value: 1.9},
  {cc_iso3c: "PAK", value: 0.643863179074447, raw_value: 0.71},
  {cc_iso3c: "PAN", value: 0.969818913480885, raw_value: 2.33},
  {cc_iso3c: "PER", value: 0.340040241448692, raw_value: -0.8},
  {cc_iso3c: "PHL", value: null, raw_value: 1.07},
  {cc_iso3c: "PLW", value: 0.51307847082495, raw_value: 0.06},
  {cc_iso3c: "PNG", value: 0.13682092555332, raw_value: -1.81},
  {cc_iso3c: "POL", value: 0.340040241448692, raw_value: -0.8},
  {cc_iso3c: "PRI", value: 0.951710261569417, raw_value: 2.24},
  {cc_iso3c: "PRK", value: 0.591549295774648, raw_value: 0.45},
  {cc_iso3c: "PRT", value: 0.503018108651911, raw_value: 0.01},
  {cc_iso3c: "PRY", value: 0.559356136820926, raw_value: 0.29},
  {cc_iso3c: "PSE", value: 0.392354124748491, raw_value: -0.54},
  {cc_iso3c: "QAT", value: 0.0140845070422536, raw_value: -2.42},
  {cc_iso3c: "ROU", value: 0.23943661971831, raw_value: -1.3},
  {cc_iso3c: "RUS", value: null, raw_value: null},
  {cc_iso3c: "RWA", value: 0.364185110663984, raw_value: -0.68},
  {cc_iso3c: "SAU", value: 0.23943661971831, raw_value: -1.3},
  {cc_iso3c: "SDN", value: 0.366197183098592, raw_value: -0.67},
  {cc_iso3c: "SEN", value: 0.887323943661972, raw_value: 1.92},
  {cc_iso3c: "SGP", value: 0.0784708249496982, raw_value: -2.1},
  {cc_iso3c: "SJM", value: 0.871227364185111, raw_value: 1.84},
  {cc_iso3c: "SLB", value: 0.285714285714286, raw_value: -1.07},
  {cc_iso3c: "SLE", value: 0.404426559356137, raw_value: -0.48},
  {cc_iso3c: "SLV", value: 0.28169014084507, raw_value: -1.09},
  {cc_iso3c: "SMR", value: 0.979879275653923, raw_value: 2.38},
  {cc_iso3c: "SOM", value: 0.162977867203219, raw_value: -1.68},
  {cc_iso3c: "SRB", value: 0.0503018108651911, raw_value: -2.24},
  {cc_iso3c: "SSD", value: null, raw_value: -1.56},
  {cc_iso3c: "STP", value: 0.474849094567404, raw_value: -0.13},
  {cc_iso3c: "SUR", value: 0.802816901408451, raw_value: 1.5},
  {cc_iso3c: "SVK", value: 0.545271629778672, raw_value: 0.22},
  {cc_iso3c: "SVN", value: 0.3158953722334, raw_value: -0.92},
  {cc_iso3c: "SWE", value: 0.762575452716298, raw_value: 1.3},
  {cc_iso3c: "SWZ", value: 0.00402414486921529, raw_value: -2.47},
  {cc_iso3c: "SYC", value: 0.169014084507042, raw_value: -1.65},
  {cc_iso3c: "SYR", value: 0.915492957746479, raw_value: 2.06},
  {cc_iso3c: "TCD", value: 0.0261569416498995, raw_value: -2.36},
  {cc_iso3c: "TGO", value: 0.488933601609658, raw_value: -0.06},
  {cc_iso3c: "THA", value: 0.784708249496982, raw_value: 1.41},
  {cc_iso3c: "TJK", value: 0.967806841046278, raw_value: 2.32},
  {cc_iso3c: "TKM", value: 0.883299798792757, raw_value: 1.9},
  {cc_iso3c: "TLS", value: 0.6579476861167, raw_value: 0.78},
  {cc_iso3c: "TON", value: 0.977867203219316, raw_value: 2.37},
  {cc_iso3c: "TTO", value: 0.430583501006036, raw_value: -0.35},
  {cc_iso3c: "TUN", value: 0.0281690140845071, raw_value: -2.35},
  {cc_iso3c: "TUR", value: 0.0945674044265594, raw_value: -2.02},
  {cc_iso3c: "TUV", value: 0, raw_value: -2.49},
  {cc_iso3c: "TWN", value: 0.601609657947686, raw_value: 0.5},
  {cc_iso3c: "TZA", value: 0.674044265593561, raw_value: 0.86},
  {cc_iso3c: "UGA", value: 0.800804828973843, raw_value: 1.49},
  {cc_iso3c: "UKR", value: 0.845070422535211, raw_value: 1.71},
  {cc_iso3c: "URY", value: null, raw_value: 2.46},
  {cc_iso3c: "USA", value: 1, raw_value: 2.48},
  {cc_iso3c: "UZB", value: 0.54728370221328, raw_value: 0.23},
  {cc_iso3c: "VAT", value: 0.808853118712274, raw_value: 1.53},
  {cc_iso3c: "VCT", value: null, raw_value: -1.55},
  {cc_iso3c: "VEN", value: 0.507042253521127, raw_value: 0.03},
  {cc_iso3c: "VNM", value: 0.354124748490946, raw_value: -0.73},
  {cc_iso3c: "VUT", value: 0.871227364185111, raw_value: 1.84},
  {cc_iso3c: "WSM", value: 0.458752515090543, raw_value: -0.21},
  {cc_iso3c: "XCN", value: 0.619718309859155, raw_value: 0.59},
  {cc_iso3c: "XKK", value: null, raw_value: 0.56},
  {cc_iso3c: "YEM", value: 0.696177062374245, raw_value: 0.97},
  {cc_iso3c: "ZAF", value: null, raw_value: null},
  {cc_iso3c: "ZMB", value: 0.841046277665996, raw_value: 1.69},
  {cc_iso3c: "ZWE", value: 0.987927565392354, raw_value: 2.42}
]

world_lowres = FileAttachment("world_lowres.geojson").json()

geodata = geoviz.tool.merge({
  geom: world_lowres,
  geom_id: "cc_iso3c",
  data: dummy_data,
  data_id: "cc_iso3c"
})

plotworld = geodata.featureCollection

```

Plot

```{ojs}

{
  {
  let svg = geoviz.create({
    projection: d3.geoEqualEarth().fitSize([750,330], plotworld),
    width: 750,
    zoomable: true
  });
  svg.plot({
    type: "choro",
    data: plotworld,
    var: (show_raw) ? "raw_value" : "value",
    colors: "YlGnBu",
    nb: 5,
    stroke: "#e0e0e0",
    missing: "#f0f0f0",
    leg_title: " ",
    leg_pos: [10,10],
    tip: d => 
      `${d.properties.cc_iso3c}
      Metric score: ${(d.properties.value == null) ? "No data" : d.properties.value}
      Raw score: ${(d.properties.raw_value == null) ? "No data" : d.properties.raw_value}`,
    tipstyle: {
      fontSize: 10,
      background: "#ffffff",
      stroke: "#e0e0e0",
      textDecoration: "none"
  }
  });
  
  return svg.render();
    
  }
}

```

```{ojs}
viewof show_raw = Inputs.toggle({label: "Show raw values", value: false})
```
